#include <stdio.h>
#include <math.h>
#include "../vector.h"
#include "t_util.h"

struct add_test {
  float va[4];
  float vb[4];
  float vr[4];
  unsigned int sz;
};

struct add_test tests[] = {
  /* tools/add_gen.c */
  {
    {0.000000, 0.000000, 0.000000, 0.000000},
    {0.000000, 0.000000, 0.000000, 0.000000},
    {0.000000, 0.000000, 0.000000, 0.000000},
    4,
  },
  {
    {4.377899, 30.090910, 0.000000, 0.000000},
    {27.385057, 3.817585, 0.000000, 0.000000},
    {31.762957, 33.908495, 0.000000, 0.000000},
    2,
  },
  {
    {25.290323, -5.781327, 0.000000, 0.000000},
    {5.979849, 0.457293, 0.000000, 0.000000},
    {31.270172, -5.324034, 0.000000, 0.000000},
    2,
  },
  {
    {26.832371, 4.749634, 0.000000, 0.000000},
    {-34.513512, 3.084321, 0.000000, 0.000000},
    {-7.681141, 7.833955, 0.000000, 0.000000},
    2,
  },
  {
    {-1.293821, -6.308176, 0.000000, 0.000000},
    {-3.401869, 11.176744, 0.000000, 0.000000},
    {-4.695690, 4.868568, 0.000000, 0.000000},
    2,
  },
  {
    {23.354679, 1.729110, 0.000000, 0.000000},
    {21.562130, 7.459313, 0.000000, 0.000000},
    {44.916809, 9.188423, 0.000000, 0.000000},
    2,
  },
  {
    {-7.276850, -2.321070, 0.000000, 0.000000},
    {0.209166, 2.417995, 0.000000, 0.000000},
    {-7.067684, 0.096925, 0.000000, 0.000000},
    2,
  },
  {
    {8.112211, -7.894531, 0.000000, 0.000000},
    {0.757969, -3.400814, 0.000000, 0.000000},
    {8.870181, -11.295345, 0.000000, 0.000000},
    2,
  },
  {
    {12.077193, -4.905963, 0.000000, 0.000000},
    {2.058021, 11.116992, 0.000000, 0.000000},
    {14.135214, 6.211029, 0.000000, 0.000000},
    2,
  },
  {
    {-3.521595, -1.574757, 0.000000, 0.000000},
    {-3.628346, -27.248554, 0.000000, 0.000000},
    {-7.149941, -28.823312, 0.000000, 0.000000},
    2,
  },
  {
    {-8.081301, 3.739879, 2.871236, 0.000000},
    {-3.350538, -4.798475, 18.886076, 0.000000},
    {-11.431838, -1.058596, 21.757312, 0.000000},
    3,
  },
  {
    {7.626667, 173.357147, 4.179688, 0.000000},
    {10.225564, -10.120254, 29.255173, 0.000000},
    {17.852231, 163.236894, 33.434860, 0.000000},
    3,
  },
  {
    {-0.394595, 4.546584, -0.564804, 0.000000},
    {-8.859106, -1.177966, -6.281250, 0.000000},
    {-9.253701, 3.368618, -6.846054, 0.000000},
    3,
  },
  {
    {-2.144796, -0.987558, -12.117647, 0.000000},
    {4.103093, -106.750000, 20.949368, 0.000000},
    {1.958296, -107.737558, 8.831720, 0.000000},
    3,
  },
  {
    {-0.913357, -7.215640, 9.113636, 0.000000},
    {-3.810878, 8.471624, 4.540613, 0.000000},
    {-4.724235, 1.255985, 13.654249, 0.000000},
    3,
  },
  {
    {-0.872375, 1.559391, 49.555557, 0.000000},
    {6.618055, 3.583081, 1.423957, 0.000000},
    {5.745681, 5.142472, 50.979514, 0.000000},
    3,
  },
  {
    {4.326488, 1.263323, -2.148535, 0.000000},
    {0.166023, -6.079082, -10.735100, 0.000000},
    {4.492512, -4.815759, -12.883635, 0.000000},
    3,
  },
  {
    {1.126526, 12.804733, 0.524038, 0.000000},
    {49.816666, 4.481203, 3.268333, 0.000000},
    {50.943192, 17.285936, 3.792372, 0.000000},
    3,
  },
  {
    {-3.538818, 53.161766, -47.756756, 0.000000},
    {8.226923, -7.255193, 56.444443, 0.000000},
    {4.688105, 45.906573, 8.687687, 0.000000},
    3,
  },
  {
    {-4.188148, 6.470588, -1.560510, 0.000000},
    {13.654136, -13.719008, 550.444458, 0.000000},
    {9.465988, -7.248420, 548.883948, 0.000000},
    3,
  },
  {
    {-4.515442, 0.107062, -3.628399, -9.280220},
    {-25.652632, -4.955530, 7.231579, 3.547988},
    {-30.168074, -4.848469, 3.603180, -5.732232},
    4,
  },
  {
    {-56.761364, 22.971910, -5.281723, 12.731092},
    {4.502128, -1.806150, -2.995516, 0.589404},
    {-52.259236, 21.165761, -8.277239, 13.320496},
    4,
  },
  {
    {26.401409, 6.235885, -5.739916, 1.800472},
    {27.752687, 3.642857, -8.210432, 3.760870},
    {54.154097, 9.878742, -13.950348, 5.561342},
    4,
  },
  {
    {-4.879818, 18.270073, 3.863354, 8.763158},
    {-8.900744, 37.870968, 10.340117, 37.436783},
    {-13.780563, 56.141041, 14.203470, 46.199941},
    4,
  },
  {
    {-1.096257, 3.534791, -801.333313, -2.359408},
    {-0.542105, 80.550003, -215.000000, -0.597959},
    {-1.638362, 84.084794, -1016.333313, -2.957367},
    4,
  },
  {
    {-2.260730, -5.096128, -14.550562, 41.324562},
    {17.250000, -9.409091, 1.174680, 3.246465},
    {14.989270, -14.505219, -13.375882, 44.571027},
    4,
  },
  {
    {-10.110656, -5.273002, -10.329646, 2.396825},
    {-37.973213, 14.538940, -3.133487, -3.556911},
    {-48.083869, 9.265939, -13.463133, -1.160085},
    4,
  },
  {
    {-3.132231, 1.081250, 5.449814, 9.403471},
    {-2.869848, -4.135392, -4.765121, 0.839286},
    {-6.002080, -3.054142, 0.684693, 10.242757},
    4,
  },
  {
    {3.400922, 3.868812, 4.662546, -6.474120},
    {-1.389303, 2.290909, 0.702048, 9.117904},
    {2.011618, 6.159721, 5.364595, 2.643784},
    4,
  },
  {
    {-1.506061, 2.912821, 1.993789, 13.287356},
    {-3.816121, -2.831325, -7.281847, -1.070103},
    {-5.322181, 0.081495, -5.288058, 12.217253},
    4,
  },
};

int main()
{
  float tmp[4] = {0, 0, 0, 0};
  unsigned int ind;
  unsigned int jnd;

  for (ind = 0; ind < sizeof(tests) / sizeof(struct add_test); ++ind) {
    switch (tests[ind].sz) {
      case 4:
        vec_add4fx(tests[ind].va, tests[ind].vb, tmp);
        break;
      case 3:
        vec_add3fx(tests[ind].va, tests[ind].vb, tmp);
        break;
      case 2:
        vec_add2fx(tests[ind].va, tests[ind].vb, tmp);
        break;
      default:
        printf("error: ended up in default switch statement\n");
        return 2;
    }
    for (jnd = 0; jnd < tests[ind].sz; ++jnd) {
      if (!approx_equalf(tests[ind].vr[jnd], tmp[jnd], APPROX_MAX_ERROR)) {
        printf("fail: [%u] vr[%u] %f != tmp[%u] %f\n",
                ind, jnd, tests[ind].vr[jnd], jnd, tmp[jnd]);
        return 1;
      }
      printf("[%u] vr[%u] %f ~ tmp[%u] %f\n",
              ind, jnd, tests[ind].vr[jnd], jnd, tmp[jnd]);
    }
    printf("--\n");
  }

  return 0;
} 
