#include <stdio.h>
#include <math.h>
#include "../vector.h"
#include "t_util.h"

struct subsc_test {
  float va[4];
  float vr[4];
  float sc;
  unsigned int sz;
  char align[24];
};

struct subsc_test tests[] = {
  /* tools/subsc_gen.c */
  {
    {0.000000, 0.000000, 0.000000, 0.000000},
    {0.000000, 0.000000, 0.000000, 0.000000},
    0.000000,
    4,
  },
  {
    {1.010020, 12.381579, 0.000000, 0.000000},
    {-18.284396, -6.912837, -19.294416, -19.294416},
    19.294416,
    2,
  },
  {
    {4.841410, 4.861912, 0.000000, 0.000000},
    {2.636648, 2.657150, -2.204762, -2.204762},
    2.204762,
    2,
  },
  {
    {-5.948718, 2.305901, 0.000000, 0.000000},
    {39.271062, 47.525681, 45.219780, 45.219780},
    -45.219780,
    2,
  },
  {
    {6.447635, -19.012606, 0.000000, 0.000000},
    {-19.388728, -44.848969, -25.836363, -25.836363},
    25.836363,
    2,
  },
  {
    {1.856884, 4.883260, 0.000000, 0.000000},
    {-2.681342, 0.345034, -4.538226, -4.538226},
    4.538226,
    2,
  },
  {
    {-80.055557, 2.026066, 0.000000, 0.000000},
    {-74.143992, 7.937631, 5.911565, 5.911565},
    -5.911565,
    2,
  },
  {
    {-6.455969, -4.402532, 0.000000, 0.000000},
    {3.030413, 5.083850, 9.486382, 9.486382},
    -9.486382,
    2,
  },
  {
    {-3.892634, -4.182353, 0.000000, 0.000000},
    {-6.593608, -6.883327, -2.700974, -2.700974},
    2.700974,
    2,
  },
  {
    {-4.885798, 2.459460, 0.000000, 0.000000},
    {-35.252705, -27.907448, -30.366907, -30.366907},
    30.366907,
    2,
  },
  {
    {26.460869, -20.231707, 5.940893, 0.000000},
    {30.837613, -15.854962, 10.317637, 4.376744},
    -4.376744,
    3,
  },
  {
    {-5.475083, 1.475687, 49.081635, 0.000000},
    {0.671910, 7.622680, 55.228628, 6.146993},
    -6.146993,
    3,
  },
  {
    {-12.930723, 0.863636, -6.186757, 0.000000},
    {-11.491411, 2.302949, -4.747445, 1.439313},
    -1.439313,
    3,
  },
  {
    {-11.362416, 5.452013, -1.337091, 0.000000},
    {-6.272803, 10.541625, 3.752522, 5.089613},
    -5.089613,
    3,
  },
  {
    {12.344498, -7.833333, 4.945158, 0.000000},
    {14.308134, -5.869697, 6.908794, 1.963636},
    -1.963636,
    3,
  },
  {
    {2.731422, -17.346153, -8.728459, 0.000000},
    {-1.045000, -21.122576, -12.504882, -3.776423},
    3.776423,
    3,
  },
  {
    {-5.393855, 13.218905, 9.058586, 0.000000},
    {-12.160416, 6.452344, 2.292025, -6.766562},
    6.766562,
    3,
  },
  {
    {-20.479591, -0.730981, 1.537794, 0.000000},
    {-20.529591, -0.780981, 1.487794, -0.050000},
    0.050000,
    3,
  },
  {
    {-5.209246, 6.566176, -6.379870, 0.000000},
    {-2.361995, 9.413427, -3.532619, 2.847250},
    -2.847250,
    3,
  },
  {
    {-4.850329, 3.007035, -60.147541, 0.000000},
    {-10.185075, -2.327711, -65.482287, -5.334746},
    5.334746,
    3,
  },
  {
    {-3.700000, -4.679797, -1.201072, -5.901720},
    {-4.452577, -5.432374, -1.953650, -6.654297},
    0.752577,
    4,
  },
  {
    {-8.882023, 0.717460, -5.608626, 0.114865},
    {-15.812792, -6.213309, -12.539396, -6.815905},
    6.930769,
    4,
  },
  {
    {-11.011876, 0.140777, -3.486747, 182.285721},
    {-12.233345, -1.080692, -4.708216, 181.064252},
    1.221469,
    4,
  },
  {
    {-2.133663, -13.431487, 143.375000, 1.401649},
    {-1.033193, -12.331016, 144.475471, 2.502120},
    -1.100471,
    4,
  },
  {
    {17.132576, -4.354317, -3.292390, -3.816667},
    {16.110837, -5.376056, -4.314129, -4.838406},
    1.021739,
    4,
  },
  {
    {3341.000000, -14.605263, 0.194595, -19.964602},
    {3336.557778, -19.047485, -4.247628, -24.406824},
    4.442222,
    4,
  },
  {
    {3.464242, -8.421053, -7.573798, -3.324662},
    {-1.264924, -13.150219, -12.302964, -8.053828},
    4.729167,
    4,
  },
  {
    {27.769230, 2.435835, -0.087912, 4.100733},
    {32.489230, 7.155835, 4.632088, 8.820733},
    -4.720000,
    4,
  },
  {
    {-8.800377, -17.685535, -14.523012, -14.030769},
    {-12.819577, -21.704735, -18.542212, -18.049969},
    4.019200,
    4,
  },
  {
    {6.331437, 2.048517, 1.365602, -8.840206},
    {-25.500625, -29.783544, -30.466459, -40.672268},
    31.832062,
    4,
  },
};

int main()
{
  unsigned int ind;
  unsigned int jnd;

  for (ind = 0; ind < sizeof(tests) / sizeof(struct subsc_test); ++ind) {
    switch (tests[ind].sz) {
      case 4:
        vec_subsc4f(tests[ind].va, tests[ind].sc);
        break;
      case 3:
        vec_subsc3f(tests[ind].va, tests[ind].sc);
        break;
      case 2:
        vec_subsc2f(tests[ind].va, tests[ind].sc);
        break;
      default:
        printf("error: ended up in default switch statement\n");
        return 2;
    }
    for (jnd = 0; jnd < tests[ind].sz; ++jnd) {
      if (!approx_equalf(tests[ind].vr[jnd],
                         tests[ind].va[jnd], APPROX_MAX_ERROR)) {
        printf("fail: [%u] vr[%u] %f != va[%u] %f\n",
                ind, jnd, tests[ind].vr[jnd], jnd, tests[ind].va[jnd]);
        return 1;
      }
      printf("[%u] vr[%u] %f ~ va[%u] %f\n",
              ind, jnd, tests[ind].vr[jnd], jnd, tests[ind].va[jnd]);
    }
    printf("--\n");
  }

  return 0;
} 
