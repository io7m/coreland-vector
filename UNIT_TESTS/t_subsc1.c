#include <stdio.h>
#include <math.h>
#include "../vector.h"
#include "t_util.h"

struct subsc_test {
  float va[4];
  float sc;
  float vr[4];
  unsigned int sz;
};

struct subsc_test tests[] = {
  /* tools/subsc_gen.c */
  {
    {0.000000, 0.000000, 0.000000, 0.000000},
    0.000000,
    {0.000000, 0.000000, 0.000000, 0.000000},
    4,
  },
  {
    {-18.944916, 46.222221, 0.000000, 0.000000},
    5.052414,
    {-23.997330, 41.169807, -5.052414, -5.052414},
    2,
  },
  {
    {-16.750000, 4.627791, 0.000000, 0.000000},
    -3.031621,
    {-13.718379, 7.659412, 3.031621, 3.031621},
    2,
  },
  {
    {-7.842900, 30.277779, 0.000000, 0.000000},
    27.930233,
    {-35.773133, 2.347546, -27.930233, -27.930233},
    2,
  },
  {
    {-13.247312, 2.770925, 0.000000, 0.000000},
    3.975482,
    {-17.222793, -1.204556, -3.975482, -3.975482},
    2,
  },
  {
    {4.227571, -14.244318, 0.000000, 0.000000},
    3.654800,
    {0.572771, -17.899118, -3.654800, -3.654800},
    2,
  },
  {
    {-7.054656, -0.535316, 0.000000, 0.000000},
    1.445757,
    {-8.500413, -1.981073, -1.445757, -1.445757},
    2,
  },
  {
    {-4.194030, -7.537480, 0.000000, 0.000000},
    -6.396460,
    {2.202430, -1.141020, 6.396460, 6.396460},
    2,
  },
  {
    {-0.320000, 4.791139, 0.000000, 0.000000},
    -5.853565,
    {5.533565, 10.644704, 5.853565, 5.853565},
    2,
  },
  {
    {-4.047458, -6.121951, 0.000000, 0.000000},
    6.262500,
    {-10.309958, -12.384451, -6.262500, -6.262500},
    2,
  },
  {
    {36.616665, 10.346847, 2.096234, 0.000000},
    100.918922,
    {-64.302258, -90.572076, -98.822688, -100.918922},
    3,
  },
  {
    {-78.882355, -4.989384, 962.599976, 0.000000},
    2.518518,
    {-81.400873, -7.507903, 960.081457, -2.518518},
    3,
  },
  {
    {-27.988506, 2.064865, 6.856833, 0.000000},
    -3.032727,
    {-24.955779, 5.097592, 9.889560, 3.032727},
    3,
  },
  {
    {-3.915789, -0.095238, 3.815151, 0.000000},
    -3.153930,
    {-0.761859, 3.058692, 6.969082, 3.153930},
    3,
  },
  {
    {-14.593023, -2.943421, 2.819556, 0.000000},
    0.010601,
    {-14.603624, -2.954022, 2.808956, -0.010601},
    3,
  },
  {
    {3.454208, 9.106796, -1.768829, 0.000000},
    -2.145740,
    {5.599948, 11.252536, 0.376911, 2.145740},
    3,
  },
  {
    {0.193364, 29.299999, -6.290323, 0.000000},
    -124.550003,
    {124.743367, 153.850002, 118.259680, 124.550003},
    3,
  },
  {
    {1.569307, -10.634845, 17.757895, 0.000000},
    517.000000,
    {-515.430693, -527.634845, -499.242105, -517.000000},
    3,
  },
  {
    {-1.308989, 5.680628, 4.615049, 0.000000},
    3.248588,
    {-4.557576, 2.432041, 1.366461, -3.248588},
    3,
  },
  {
    {-3.093333, 4.326530, 0.673307, 0.000000},
    1.001376,
    {-4.094709, 3.325155, -0.328069, -1.001376},
    3,
  },
  {
    {-1.295693, 3.704327, -0.353434, -76.980003},
    13.867925,
    {-15.163617, -10.163598, -14.221359, -90.847928},
    4,
  },
  {
    {-6.389368, -8.442043, 0.226744, 2.317132},
    -20.382774,
    {13.993407, 11.940731, 20.609519, 22.699907},
    4,
  },
  {
    {-8.676171, 1.862366, 3.598071, -7.660000},
    48.468086,
    {-57.144258, -46.605721, -44.870016, -56.128086},
    4,
  },
  {
    {3.700971, -5.934236, 7.756152, 52.726028},
    7.331715,
    {-3.630744, -13.265951, 0.424437, 45.394313},
    4,
  },
  {
    {3.973174, -44.929413, 1.645946, -21.850000},
    -0.251152,
    {4.224326, -44.678261, 1.897098, -21.598848},
    4,
  },
  {
    {-12.775438, -4.459954, 7.195502, -2.308261},
    0.906977,
    {-13.682415, -5.366931, 6.288525, -3.215238},
    4,
  },
  {
    {1.928760, -6.241379, 5.247989, 3.794078},
    4.853595,
    {-2.924835, -11.094974, 0.394394, -1.059517},
    4,
  },
  {
    {12.674286, -3.192105, -4.022704, -2.416555},
    -0.591963,
    {13.266249, -2.600142, -3.430741, -1.824592},
    4,
  },
  {
    {-0.209877, 3.641337, 2.349741, 8.932961},
    0.785530,
    {-0.995406, 2.855808, 1.564211, 8.147431},
    4,
  },
  {
    {-6.995098, 38.347458, -2.759690, -3.953283},
    -69.800003,
    {62.804905, 108.147461, 67.040313, 65.846720},
    4,
  },
};

int main()
{
  unsigned int ind;
  unsigned int jnd;

  for (ind = 0; ind < sizeof(tests) / sizeof(struct subsc_test); ++ind) {
    switch (tests[ind].sz) {
      case 4:
        vec_subsc4f(tests[ind].va, tests[ind].sc);
        break;
      case 3:
        vec_subsc3f(tests[ind].va, tests[ind].sc);
        break;
      case 2:
        vec_subsc2f(tests[ind].va, tests[ind].sc);
        break;
      default:
        printf("error: ended up in default switch statement\n");
        return 2;
    }
    for (jnd = 0; jnd < tests[ind].sz; ++jnd) {
      if (!approx_equalf(tests[ind].vr[jnd],
                         tests[ind].va[jnd], APPROX_MAX_ERROR)) {
        printf("fail: [%u] vr[%u] %f != va[%u] %f\n",
                ind, jnd, tests[ind].vr[jnd], jnd, tests[ind].va[jnd]);
        return 1;
      }
      printf("[%u] vr[%u] %f ~ va[%u] %f\n",
              ind, jnd, tests[ind].vr[jnd], jnd, tests[ind].va[jnd]);
    }
    printf("--\n");
  }

  return 0;
} 
