#include <stdio.h>
#include <math.h>
#include "../vector.h"
#include "t_util.h"

struct mag_test {
  float va[4];
  float vr;
  unsigned int sz;
};

struct mag_test tests[] = {
  /* tools/mag_gen.c */
  {
    {0.000000, 0.000000, 0.000000, 0.000000},
    0.000000,
    4,
  },
  {
    {2.831653, 10.895307, 0.000000, 0.000000},
    11.257263,
    2,
  },
  {
    {3.123145, -14.444445, 0.000000, 0.000000},
    14.778228,
    2,
  },
  {
    {-4.494802, -2.546354, 0.000000, 0.000000},
    5.165962,
    2,
  },
  {
    {6.493750, 4.982759, 0.000000, 0.000000},
    8.185149,
    2,
  },
  {
    {-1.414389, -1.689781, 0.000000, 0.000000},
    2.203600,
    2,
  },
  {
    {-4.220310, 4.034448, 0.000000, 0.000000},
    5.838474,
    2,
  },
  {
    {19.669603, 33.208694, 0.000000, 0.000000},
    38.596771,
    2,
  },
  {
    {-3.784661, -6.511312, 0.000000, 0.000000},
    7.531324,
    2,
  },
  {
    {2.456274, 10.415094, 0.000000, 0.000000},
    10.700816,
    2,
  },
  {
    {5.465333, 6.232284, 14.058824, 0.000000},
    16.320593,
    3,
  },
  {
    {-0.747610, 27.390072, 7.348659, 0.000000},
    28.368605,
    3,
  },
  {
    {-2.507395, -0.259310, 3.890961, 0.000000},
    4.636146,
    3,
  },
  {
    {26.876713, -5.167924, -1.048452, 0.000000},
    27.389128,
    3,
  },
  {
    {-9.824243, -4.468750, 26.200001, 0.000000},
    28.335941,
    3,
  },
  {
    {-1.115790, -7.300734, -1.769022, 0.000000},
    7.594415,
    3,
  },
  {
    {3.755245, -2.169955, 8.839323, 0.000000},
    9.846025,
    3,
  },
  {
    {-0.390501, -0.498480, -5.723821, 0.000000},
    5.758741,
    3,
  },
  {
    {1.127778, -2.705263, -3.108108, 0.000000},
    4.272080,
    3,
  },
  {
    {653.000000, -0.921544, 25.035715, 0.000000},
    653.480408,
    3,
  },
  {
    {-3.635088, 2.734637, -15.437288, 128.413788},
    129.418335,
    4,
  },
  {
    {-10.517074, 0.363215, -5.624434, -4.359574},
    12.703579,
    4,
  },
  {
    {-3.004233, -4.106761, -13.732955, 6.619427},
    16.071770,
    4,
  },
  {
    {1.004769, -39.042736, -1.922646, -7.112853},
    39.744610,
    4,
  },
  {
    {7.697345, -6.037831, 0.218868, 15.768167},
    18.557680,
    4,
  },
  {
    {-5.466357, 4.331652, -9.861461, 1.017804},
    12.121411,
    4,
  },
  {
    {-8.252032, 14.677249, 5.720217, -4.095494},
    18.248606,
    4,
  },
  {
    {5.494382, -1.351603, -1.518950, -6.700197},
    8.900276,
    4,
  },
  {
    {15.153094, 26.511906, 5.822034, 170.000000},
    172.818954,
    4,
  },
  {
    {-49.927834, -9.486316, -15.847108, -2.708995},
    53.303360,
    4,
  },
};

int main()
{
  float mag;
  unsigned int ind;
  unsigned int jnd;

  for (ind = 0; ind < sizeof(tests) / sizeof(struct mag_test); ++ind) {
    switch (tests[ind].sz) {
      case 4:
        mag = vec_mag4f(tests[ind].va);
        break;
      case 3:
        mag = vec_mag3f(tests[ind].va);
        break;
      case 2:
        mag = vec_mag2f(tests[ind].va);
        break;
      default:
        printf("error: ended up in default switch statement\n");
        return 2;
    }
    for (jnd = 0; jnd < tests[ind].sz; ++jnd) {
      if (!approx_equalf(tests[ind].vr, mag, APPROX_MAX_ERROR)) {
        printf("fail: [%u] vr %f != mag %f\n",
                ind, tests[ind].vr, mag);
        return 1;
      }
    }
    printf("[%u] mag %f\n", ind, mag);
  }

  return 0;
} 
