#include <stdio.h>
#include <math.h>
#include "../vector.h"
#include "t_util.h"

struct xprod_test {
  float va[3];
  float vb[3];
  float vr[3];
};

struct xprod_test tests[] = {
  /* tools/xprod_gen.c */
  {
    {0.000000, 0.000000, 0.000000},
    {0.000000, 0.000000, 0.000000},
    {0.000000, 0.000000, 0.000000},
  },
  {
    {-0.189066, 4.079019, 9.815104},
    {-2.081081, -21.773148, 5.689075},
    {-8.382404, -14.547888, -2.043537},
  },
  {
    {-13.263538, -2.176913, -30.320000},
    {-15.840000, -4.496939, 4.304054},
    {16.453506, 497.836395, 45.982231},
  },
  {
    {-11.700000, -3.740434, -0.958589},
    {-4.524324, -5.983075, 1.000000},
    {-8.764920, 17.036966, 69.218086},
  },
  {
    {-1.214450, 20.306452, 4.442903},
    {-3.575486, 3.470894, -6.244742},
    {-127.780563, -20.915829, -28.097162},
  },
  {
    {-8.170561, -17.632652, 12.252427},
    {5.079412, 0.644068, 30.000000},
    {-540.587952, 100.405685, 17.449669},
  },
  {
    {4.793380, 23.071428, -1.131206},
    {1.989143, -9.707775, 2.946302},
    {59.398823, -4.097208, -67.615341},
  },
  {
    {-3.134557, 8.864516, 2.411043},
    {-7.358932, 3.311209, 0.612303},
    {6.327939, -13.995840, -26.602621},
  },
  {
    {-0.942857, -5.872755, -4.279206},
    {-7.492378, -25.532051, -5.460961},
    {10.818038, 27.543325, 22.453453},
  },
  {
    {4.297521, -4.411494, 8.618799},
    {0.119946, 12.724928, -125.818184},
    {559.152344, -129.081909, 59.217079},
  },
  {
    {0.151300, -6.272610, -3.286751},
    {-45.180851, 24.337017, -6.997959},
    {71.519234, 141.348953, -35.226044},
  },
  {
    {-7.498127, 2.339156, -3.071071},
    {-5.994898, 10.157895, -8.663073},
    {-7.035309, 17.245813, -84.499245},
  },
  {
    {7.431694, 124.428574, 5.973412},
    {-5.511013, 5.049474, -6.452727},
    {-803.827576, -46.803974, -92.413445},
  },
  {
    {3.201479, -7.139194, -4.216958},
    {6.947115, 5.141304, -5.192935},
    {46.431633, -37.690105, 30.546087},
  },
  {
    {2.792576, 4.021352, -0.796537},
    {14.052631, 41.679245, -0.529032},
    {40.348358, -14.515047, 126.423752},
  },
  {
    {13.306123, -5.282012, -3.815832},
    {-3.782741, 53.820515, 2.256281},
    {45.718643, 3.384463, 717.641663},
  },
  {
    {1.978229, -3.712798, 6.132212},
    {22.562044, 5.222222, -13.241546},
    {48.253189, 123.135452, 36.605595},
  },
  {
    {11.126280, -7.632653, -2.314939},
    {-4.747561, -11.898305, -30.777779},
    {225.332748, -30.913742, -129.498779},
  },
  {
    {3.915441, 0.355342, 3.287879},
    {0.829294, -66.406250, 8.440251},
    {-66.694954, 7.251428, -259.535828},
  },
  {
    {-5.555555, -0.418953, 4.211236},
    {-4.091200, -73.222221, 24.117647},
    {-87.537605, 12.444195, 403.117859},
  },
  {
    {-1.543417, 8.012345, 4.503554},
    {-1.691729, 0.292597, -107.297295},
    {-863.913940, -113.372673, -10.155674},
  },
  {
    {-47.206184, -4.005302, -21.657534},
    {-3.194475, 1.666247, -0.227154},
    {24.233601, 116.163483, -77.846329},
  },
  {
    {7.995025, -13.255320, 3.500000},
    {-1.091743, 48.933334, 8.452381},
    {-66.605682, -3.363744, 403.386780},
  },
  {
    {1.308824, -6.094303, -3.339286},
    {-6.937131, -8.100201, -5.678571},
    {29.846016, 16.177668, -11.444562},
  },
  {
    {12.731118, -0.957360, 5.473804},
    {-2.392324, -2.426117, 1.946411},
    {-9.763337, -23.879822, -32.322144},
  },
  {
    {-3.590654, 1.689459, 0.934004},
    {1.046921, 4.070552, 4.275126},
    {10.359196, 8.843608, -15.258484},
  },
  {
    {19.151163, 0.177483, -12.459770},
    {-3.140056, 1.497931, 24.149485},
    {18.243835, 44.122700, 25.369581},
  },
  {
    {-3.084605, 2.421842, -11.959064},
    {-0.179487, 19.600878, 0.740187},
    {33.352558, 5.971291, -63.062290},
  },
  {
    {-4.763920, 92.224487, -6.152510},
    {-5.058091, 4.919192, 13.359183},
    {1243.115479, 49.243057, -120.717216},
  },
  {
    {5.248152, 0.917850, 59.303032},
    {3.722925, 9.213856, -2.853591},
    {-52.708344, 212.679016, 51.160793},
  },
};

int main()
{
  float tmp[3] = {0.0, 0.0, 0.0};
  unsigned int ind;
  unsigned int jnd;

  for (ind = 0; ind < sizeof(tests) / sizeof(struct xprod_test); ++ind) {
    vec_crossprod3fx(tests[ind].va, tests[ind].vb, tmp);

    /* APPROX_MAX_ERROR multiplied because results are likely to be
       larger due to multiplication */

    for (jnd = 0; jnd < 3; ++jnd) {
      if (!approx_equalf(tests[ind].vr[jnd], tmp[jnd], APPROX_MAX_ERRORF * 10.0)) {
        printf("fail: [%u] vr[%u] %f != tmp[%u] %f\n",
               ind, jnd, tests[ind].vr[jnd], jnd, tmp[jnd]);
        return 1;
      }
      printf("[%u] vr[%u] %f ~ tmp[%u] %f\n",
             ind, jnd, tests[ind].vr[jnd], jnd, tmp[jnd]);
    }
  }
  return 0;
} 
