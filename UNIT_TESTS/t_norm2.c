#include <stdio.h>
#include <math.h>
#include "../vector.h"
#include "t_util.h"

struct norm_test {
  float va[4];
  float vr[4];
  unsigned int sz;
};

struct norm_test tests[] = {
  /* tools/norm_gen.c */
  {
    {0.000000, 0.000000, 0.000000, 0.000000},
    {0.000000, 0.000000, 0.000000, 0.000000},
    4,
  },
  {
    {6.890026, 3.572430, 0.000000, 0.000000},
    {0.887764, 0.460299, 0.000000, 0.000000},
    2,
  },
  {
    {-0.421898, -6.502058, 0.000000, 0.000000},
    {-0.064751, -0.997901, 0.000000, 0.000000},
    2,
  },
  {
    {-7.985025, -5.625263, 0.000000, 0.000000},
    {-0.817509, -0.575916, 0.000000, 0.000000},
    2,
  },
  {
    {-8.952381, -1.727642, 0.000000, 0.000000},
    {-0.981884, -0.189485, 0.000000, 0.000000},
    2,
  },
  {
    {8.246914, -1.336957, 0.000000, 0.000000},
    {0.987113, -0.160027, 0.000000, 0.000000},
    2,
  },
  {
    {3.013064, 2.687412, 0.000000, 0.000000},
    {0.746285, 0.665626, 0.000000, 0.000000},
    2,
  },
  {
    {5.509363, -22.381166, 0.000000, 0.000000},
    {0.239025, -0.971013, 0.000000, 0.000000},
    2,
  },
  {
    {0.900243, -7.573370, 0.000000, 0.000000},
    {0.118039, -0.993009, 0.000000, 0.000000},
    2,
  },
  {
    {0.732824, 10.382353, 0.000000, 0.000000},
    {0.070408, 0.997518, 0.000000, 0.000000},
    2,
  },
  {
    {-2.254355, -10.917431, -0.160650, 0.000000},
    {-0.202204, -0.979237, -0.014409, 0.000000},
    3,
  },
  {
    {-5.253076, -13.439629, -20.886364, 0.000000},
    {-0.206927, -0.529407, -0.822745, 0.000000},
    3,
  },
  {
    {24.000000, -0.205970, -0.785507, 0.000000},
    {0.999428, -0.008577, -0.032711, 0.000000},
    3,
  },
  {
    {-4.595800, 13.985915, 2.592520, 0.000000},
    {-0.307449, 0.935626, 0.173434, 0.000000},
    3,
  },
  {
    {-40.051281, 7.290566, 0.340708, 0.000000},
    {-0.983799, 0.179082, 0.008369, 0.000000},
    3,
  },
  {
    {-1.321221, -4.511059, -13.816265, 0.000000},
    {-0.090532, -0.309104, -0.946709, 0.000000},
    3,
  },
  {
    {-4.502577, -1.206186, 2.429825, 0.000000},
    {-0.856552, -0.229460, 0.462240, 0.000000},
    3,
  },
  {
    {8.532872, 104.000000, 4.244332, 0.000000},
    {0.081705, 0.995828, 0.040641, 0.000000},
    3,
  },
  {
    {-6.339394, -2.504028, -14.727642, 0.000000},
    {-0.390635, -0.154299, -0.907522, 0.000000},
    3,
  },
  {
    {2.297872, 4.416529, -2.940850, 0.000000},
    {0.397400, 0.763807, -0.508599, 0.000000},
    3,
  },
  {
    {-7.971910, 0.076000, -54.620689, 5.976339},
    {-0.143581, 0.001369, -0.983766, 0.107639},
    4,
  },
  {
    {22.729412, 0.405562, 16.493244, -2.881703},
    {0.805055, 0.014365, 0.584176, -0.102067},
    4,
  },
  {
    {-5.648855, -2.347426, 4.018895, 5.998175},
    {-0.596937, -0.248062, 0.424693, 0.633851},
    4,
  },
  {
    {-20.838028, 6.132570, -69.169228, 0.480315},
    {-0.287416, 0.084586, -0.954041, 0.006625},
    4,
  },
  {
    {11.720930, 0.227129, 17.808290, 2.135593},
    {0.547010, 0.010600, 0.831104, 0.099667},
    4,
  },
  {
    {0.428184, 0.887755, 4.170347, -108.255814},
    {0.003952, 0.008194, 0.038493, -0.999218},
    4,
  },
  {
    {2.599196, 5.797619, -2.386364, -64.891891},
    {0.039837, 0.088858, -0.036575, -0.994575},
    4,
  },
  {
    {-8.185082, 9.356902, -2.204797, -87.826088},
    {-0.092248, 0.105455, -0.024849, -0.989824},
    4,
  },
  {
    {28.054216, -9.750000, 1.727069, 3.425220},
    {0.936799, -0.325576, 0.057671, 0.114376},
    4,
  },
  {
    {5.025806, 32.473682, 3.803125, -4.954887},
    {0.150254, 0.970851, 0.113700, -0.148134},
    4,
  },
};

int main()
{
  float mag;
  unsigned int ind;
  unsigned int jnd;

  for (ind = 0; ind < sizeof(tests) / sizeof(struct norm_test); ++ind) {
    switch (tests[ind].sz) {
      case 4:
        vec_norm4f(tests[ind].va);
        break;
      case 3:
        vec_norm3f(tests[ind].va);
        break;
      case 2:
        vec_norm2f(tests[ind].va);
        break;
      default:
        printf("error: ended up in default switch statement\n");
        return 2;
    }
    mag = 0.0;
    for (jnd = 0; jnd < tests[ind].sz; ++jnd) {
      if (!approx_equalf(tests[ind].vr[jnd],
                         tests[ind].va[jnd], APPROX_MAX_ERROR)) {
        printf("fail: [%u] vr[%u] %f != va[%u] %f\n",
                ind, jnd, tests[ind].vr[jnd], jnd, tests[ind].va[jnd]);
      }
      mag += (tests[ind].va[jnd] * tests[ind].va[jnd]);
      printf("[%u] vr[%u] %f ~ va[%u] %f\n",
              ind, jnd, tests[ind].vr[jnd], jnd, tests[ind].va[jnd]);
    }
    if (ind) {
      if (!approx_equalf(mag, 1.0f, APPROX_MAX_ERROR)) {
        printf("[%u] mag != 1.0f (%f)\n", ind, mag);
        return 1;
      }
    }
    printf("--\n");
  }

  return 0;
} 
