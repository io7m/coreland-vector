#include <stdio.h>
#include <math.h>
#include "../vector.h"
#include "t_util.h"

struct xprod_test {
  float va[3];
  float vb[3];
  float vr[3];
};

struct xprod_test tests[] = {
  /* GENERATION/xprod_gen.c */
  {
    {0.000000, 0.000000, 0.000000},
    {0.000000, 0.000000, 0.000000},
    {0.000000, 0.000000, 0.000000},
  },
  {
    {-7.082803, -2.423660, -6.734463},
    {4.991561, 3.019444, -8.542169},
    {41.037651, -94.117981, -9.288280},
  },
  {
    {-2.970964, -1.187261, -5.726458},
    {-4.324695, -4.969466, 0.722121},
    {-29.314781, 26.910578, 9.629561},
  },
  {
    {1.524590, 2.585120, -0.570028},
    {-3.831579, 0.299320, 0.067651},
    {0.345506, 2.080968, 10.361430},
  },
  {
    {-2.423469, 8.215569, -2.112903},
    {-0.556680, 4.252087, 3.271831},
    {35.864201, 9.105393, -5.731358},
  },
  {
    {-3.576296, -4.478146, -40.718750},
    {18.666666, -2.021978, 10.556818},
    {-129.607391, -722.328979, 90.823242},
  },
  {
    {-10.337838, -7.617978, -9.624243},
    {-4.016394, 3.873501, -5.557143},
    {79.613701, -18.794094, -70.640419},
  },
  {
    {-9.096154, 0.579787, 3.507184},
    {6.751880, -4.837399, 5.014311},
    {19.872879, 69.291031, 40.087070},
  },
  {
    {43.459015, 0.372796, -2.128801},
    {-4.637097, 2.510448, 2.724040},
    {6.359756, -108.512627, 110.830276},
  },
  {
    {40.530613, -4.824728, -82.866669},
    {5.205128, 10.817391, 4.872068},
    {872.894775, -628.799561, 463.548828},
  },
  {
    {0.315897, 36.603962, 9.905172},
    {-4.240764, 3.823458, -3.523438},
    {-166.843781, -40.892456, 156.436584},
  },
  {
    {-5.084033, 3.812739, -13.902208},
    {0.539446, 7.684085, -3.461810},
    {93.626778, -25.099442, -41.122913},
  },
  {
    {55.190475, 19.505434, -11.514056},
    {-5.285235, -4.865326, 23.770493},
    {407.634125, -1251.050293, -165.428879},
  },
  {
    {-1.192771, -5.556242, -1.301683},
    {-1.699422, -4.140351, -15.323194},
    {79.749954, -16.064955, -4.503910},
  },
  {
    {1.850549, 15.913358, 4.523416},
    {-16.687805, 1.061611, -4.654788},
    {-78.875427, -66.871971, 267.523590},
  },
  {
    {-0.233677, 2.804090, 2.746341},
    {30.314285, -1.078884, -7.138845},
    {-17.054987, 81.585197, -84.751892},
  },
  {
    {-8.666667, -8.416216, 8.137500},
    {-14.561111, -3.641940, -181.148148},
    {1554.218262, -1688.441772, -90.985977},
  },
  {
    {-1.481259, 8.722973, -12.986808},
    {-27.120300, 0.794207, 0.663317},
    {16.100311, 353.188660, 235.393219},
  },
  {
    {-4.655930, 2.802555, 7.470588},
    {5.567358, 46.054054, 23.158274},
    {-279.148529, 149.414734, -230.027252},
  },
  {
    {36.799999, 24.469387, -11.890244},
    {-182.631577, 1.781029, -2.530333},
    {-40.738815, 2264.650146, 4534.424805},
  },
  {
    {2.830508, -1.730612, -4.183155},
    {2.479310, -20.929293, 4.513841},
    {-95.362183, -23.147804, -54.949814},
  },
  {
    {-0.547170, 17.472868, -5.341429},
    {12.655827, -15.256198, -1.057895},
    {-99.974350, -68.179047, -212.785858},
  },
  {
    {-2.224583, -3.904401, -4.947812},
    {1.551310, 5.662500, 8.233791},
    {-4.131037, 10.641160, -6.539763},
  },
  {
    {6.216640, 11.196721, 13.509434},
    {9.309978, -6.303468, -0.817102},
    {76.007423, 130.852173, -143.427628},
  },
  {
    {-3.326389, 3.608321, -33.795918},
    {-0.743827, 1.654206, -30.542635},
    {-54.302250, -76.458359, -2.818563},
  },
  {
    {29.112904, 0.952310, -1.332282},
    {6.064267, -5.114504, 7.894207},
    {0.703771, -237.902588, -154.673126},
  },
  {
    {-16.718519, 2.501089, -1.409247},
    {0.614379, -5.826291, -3.559398},
    {-17.113054, -60.373684, 95.870346},
  },
  {
    {1.579480, 2.309252, 5.014030},
    {-6.624633, 3.636704, 3.868902},
    {-9.300274, -39.326965, 21.042049},
  },
  {
    {4.600217, -9.474320, 2.411458},
    {-6.693790, 162.888885, 631.285706},
    {-6373.802734, -2920.192871, 685.905090},
  },
  {
    {-1.400000, 40.888889, 4.446020},
    {-4.026022, 2.812500, -0.356882},
    {-27.096933, -18.399410, 160.682083},
  },
};

int main()
{
  float tmp[3] = {0.0, 0.0, 0.0};
  unsigned int ind;
  unsigned int jnd;

  for (ind = 0; ind < sizeof(tests) / sizeof(struct xprod_test); ++ind) {
    vec_crossprod3fx(tests[ind].va, tests[ind].vb, tmp);

    /* APPROX_MAX_ERROR multiplied because results are likely to be
       larger due to multiplication */

    for (jnd = 0; jnd < 3; ++jnd) {
      if (!approx_equalf(tests[ind].vr[jnd], tmp[jnd], APPROX_MAX_ERRORF * 10.0)) {
        printf("fail: [%u] vr[%u] %f != tmp[%u] %f\n",
               ind, jnd, tests[ind].vr[jnd], jnd, tmp[jnd]);
        return 1;
      }
      printf("[%u] vr[%u] %f ~ tmp[%u] %f\n",
             ind, jnd, tests[ind].vr[jnd], jnd, tmp[jnd]);
    }
  }
  return 0;
} 
