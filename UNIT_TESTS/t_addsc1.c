#include <stdio.h>
#include <math.h>
#include "../vector.h"
#include "t_util.h"

struct addsc_test {
  float va[4];
  float vr[4];
  float sc;
  unsigned int sz;
  char align[24];
};

struct addsc_test tests[] = {
  /* tools/addsc_gen.c */
  {
    {0.000000, 0.000000, 0.000000, 0.000000},
    {0.000000, 0.000000, 0.000000, 0.000000},
    0.000000,
    4,
  },
  {
    {0.396135, -1.626113, 0.000000, 0.000000},
    {-2.576058, -4.598307, -2.972194, -2.972194},
    -2.972194,
    2,
  },
  {
    {56.632652, 3.738144, 0.000000, 0.000000},
    {54.298107, 1.403599, -2.334545, -2.334545},
    -2.334545,
    2,
  },
  {
    {28.891891, -2.408397, 0.000000, 0.000000},
    {31.000432, -0.299856, 2.108541, 2.108541},
    2.108541,
    2,
  },
  {
    {-15.259068, 2.669399, 0.000000, 0.000000},
    {-9.988309, 7.940157, 5.270758, 5.270758},
    5.270758,
    2,
  },
  {
    {5.413559, -2.053419, 0.000000, 0.000000},
    {9.233194, 1.766216, 3.819635, 3.819635},
    3.819635,
    2,
  },
  {
    {-0.003398, 33.383179, 0.000000, 0.000000},
    {4.614380, 38.000957, 4.617778, 4.617778},
    4.617778,
    2,
  },
  {
    {-1.674927, 0.200234, 0.000000, 0.000000},
    {0.262573, 2.137734, 1.937500, 1.937500},
    1.937500,
    2,
  },
  {
    {-10.247968, -1.932203, 0.000000, 0.000000},
    {-8.889477, -0.573713, 1.358491, 1.358491},
    1.358491,
    2,
  },
  {
    {0.992443, 3.808587, 0.000000, 0.000000},
    {5.943872, 8.760015, 4.951428, 4.951428},
    4.951428,
    2,
  },
  {
    {-88.300003, 3.070608, -4.049181, 0.000000},
    {-91.809500, -0.438890, -7.558678, -3.509497},
    -3.509497,
    3,
  },
  {
    {66.711113, -7.315545, -8.988426, 0.000000},
    {92.431112, 18.404454, 16.731573, 25.719999},
    25.719999,
    3,
  },
  {
    {6.343214, 3.341791, 4.139194, 0.000000},
    {3.777557, 0.776134, 1.573537, -2.565657},
    -2.565657,
    3,
  },
  {
    {-1.505882, -30.885714, 3.930399, 0.000000},
    {-19.963629, -49.343460, -14.527347, -18.457747},
    -18.457747,
    3,
  },
  {
    {-1.606178, 2.918469, 3.263158, 0.000000},
    {0.670506, 5.195153, 5.539842, 2.276684},
    2.276684,
    3,
  },
  {
    {0.797189, -0.173804, 2.825635, 0.000000},
    {1.688226, 0.717233, 3.716672, 0.891037},
    0.891037,
    3,
  },
  {
    {0.464981, -6.000000, 1.818075, 0.000000},
    {0.268778, -6.196203, 1.621873, -0.196203},
    -0.196203,
    3,
  },
  {
    {1.639799, 2.735206, -4.578885, 0.000000},
    {5.179100, 6.274507, -1.039584, 3.539301},
    3.539301,
    3,
  },
  {
    {-12.049180, -3.581843, -0.553957, 0.000000},
    {-9.502090, -1.034753, 1.993133, 2.547090},
    2.547090,
    3,
  },
  {
    {-8.294785, 12.745563, 8.866198, 0.000000},
    {9.717192, 30.757539, 26.878174, 18.011976},
    18.011976,
    3,
  },
  {
    {-5.562867, -4.630952, -4.198773, -3.816489},
    {-3.199700, -2.267785, -1.835606, -1.453322},
    2.363167,
    4,
  },
  {
    {-1.969178, 5.360624, 9.439698, 13.117284},
    {-10.341727, -3.011925, 1.067149, 4.744735},
    -8.372549,
    4,
  },
  {
    {-9.165681, -0.813808, 1.472888, 4.749077},
    {-17.507601, -9.155727, -6.869032, -3.592843},
    -8.341920,
    4,
  },
  {
    {-16.006779, 30.625000, -11.339339, 4.193499},
    {-11.916791, 34.714987, -7.249352, 8.283486},
    4.089987,
    4,
  },
  {
    {13.024096, 4.521472, 7.661202, 23.206896},
    {4.604742, -3.897882, -0.758152, 14.787541},
    -8.419354,
    4,
  },
  {
    {7.311750, -78.928574, 13.333333, 67.984123},
    {1.696538, -84.543786, 7.718121, 62.368911},
    -5.615212,
    4,
  },
  {
    {10.178082, -29.074381, 4.698765, -2.186969},
    {13.052506, -26.199957, 7.573189, 0.687455},
    2.874424,
    4,
  },
  {
    {-47.138889, 2.198276, -8.107795, -9.794582},
    {-49.213055, 0.124110, -10.181960, -11.868748},
    -2.074166,
    4,
  },
  {
    {18.782223, 0.644205, 14.338843, 11.368421},
    {27.428168, 9.290150, 22.984789, 20.014366},
    8.645946,
    4,
  },
  {
    {2.100264, -1.218684, -8.086331, 2.030395},
    {-3.464799, -6.783746, -13.651394, -3.534667},
    -5.565063,
    4,
  },
};

int main()
{
  unsigned int ind;
  unsigned int jnd;

  for (ind = 0; ind < sizeof(tests) / sizeof(struct addsc_test); ++ind) {
    switch (tests[ind].sz) {
      case 4:
        vec_addsc4f(tests[ind].va, tests[ind].sc);
        break;
      case 3:
        vec_addsc3f(tests[ind].va, tests[ind].sc);
        break;
      case 2:
        vec_addsc2f(tests[ind].va, tests[ind].sc);
        break;
      default:
        printf("error: ended up in default switch statement\n");
        return 2;
    }
    for (jnd = 0; jnd < tests[ind].sz; ++jnd) {
      if (!approx_equalf(tests[ind].vr[jnd],
                         tests[ind].va[jnd], APPROX_MAX_ERROR)) {
        printf("fail: [%u] vr[%u] %f != va[%u] %f\n",
                ind, jnd, tests[ind].vr[jnd], jnd, tests[ind].va[jnd]);
        return 1;
      }
      printf("[%u] vr[%u] %f ~ va[%u] %f\n",
              ind, jnd, tests[ind].vr[jnd], jnd, tests[ind].va[jnd]);
    }
    printf("--\n");
  }

  return 0;
} 
