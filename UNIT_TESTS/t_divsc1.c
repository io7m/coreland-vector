#include <stdio.h>
#include <math.h>
#include "../vector.h"
#include "t_util.h"

struct divsc_test {
  float va[4];
  float vr[4];
  float sc;
  unsigned int sz;
  char align[24];
};

struct divsc_test tests[] = {
  /* tools/divsc_gen.c */
  {
    {1.000000, 1.000000, 1.000000, 1.000000},
    {1.000000, 1.000000, 1.000000, 1.000000},
    1.000000,
    4,
  },
  {
    {-61.209679, 1.444126, 1.000000, 1.000000},
    {12.565307, -0.296455, -0.205283, -0.205283},
    -4.871324,
    2,
  },
  {
    {-20.066946, 0.689579, 1.000000, 1.000000},
    {2.049640, -0.070434, -0.102140, -0.102140},
    -9.790476,
    2,
  },
  {
    {5.045952, 0.650754, 1.000000, 1.000000},
    {2.474201, 0.319087, 0.490334, 0.490334},
    2.039427,
    2,
  },
  {
    {-57.400002, 5.452926, 1.000000, 1.000000},
    {-15.253147, 1.449029, 0.265734, 0.265734},
    3.763158,
    2,
  },
  {
    {-32.610001, 1.557863, 1.000000, 1.000000},
    {-8.538913, 0.407926, 0.261850, 0.261850},
    3.818987,
    2,
  },
  {
    {-3.654902, -8.452915, 1.000000, 1.000000},
    {0.530152, 1.226114, -0.145052, -0.145052},
    -6.894068,
    2,
  },
  {
    {-3.655914, 7.000000, 1.000000, 1.000000},
    {-2.521178, 4.827314, 0.689616, 0.689616},
    1.450082,
    2,
  },
  {
    {1.552212, -2.396471, 1.000000, 1.000000},
    {-0.386272, 0.596368, -0.248853, -0.248853},
    -4.018443,
    2,
  },
  {
    {6.811940, 1.927793, 1.000000, 1.000000},
    {-3.659606, -1.035676, -0.537234, -0.537234},
    -1.861386,
    2,
  },
  {
    {-0.194949, -4.283871, 1.338686, 1.000000},
    {0.002099, 0.046134, -0.014417, -0.010769},
    -92.857140,
    3,
  },
  {
    {-27.900826, -3.073064, -4.388441, 1.000000},
    {-6.803885, -0.749396, -1.070164, 0.243860},
    4.100719,
    3,
  },
  {
    {5.061972, -10.065359, -3.697329, 1.000000},
    {-0.924924, 1.839144, 0.675576, -0.182720},
    -5.472851,
    3,
  },
  {
    {-7.484461, 0.871901, 4.450311, 1.000000},
    {-1.366568, 0.159198, 0.812570, 0.182587},
    5.476831,
    3,
  },
  {
    {4.121417, -1.037356, -6.243767, 1.000000},
    {0.116342, -0.029283, -0.176253, 0.028229},
    35.424999,
    3,
  },
  {
    {-10.816216, 69.625000, -37.058823, 1.000000},
    {10.314035, -66.392411, 35.338235, -0.953571},
    -1.048689,
    3,
  },
  {
    {0.296754, -10.191135, 49.942307, 1.000000},
    {0.260869, -8.958769, 43.903017, 0.879075},
    1.137560,
    3,
  },
  {
    {5.093440, -4.833904, 6.474138, 1.000000},
    {-1.397634, 1.326418, -1.776496, -0.274399},
    -3.644330,
    3,
  },
  {
    {-1.592539, -1.033275, 4.707490, 1.000000},
    {0.302694, 0.196394, -0.894752, -0.190070},
    -5.261224,
    3,
  },
  {
    {3613.000000, 6.135593, 4.448276, 1.000000},
    {4112.421231, 6.983710, 5.063157, 1.138229},
    0.878558,
    3,
  },
  {
    {-6.875000, -17.072992, -4.811231, 1.130719},
    {-3.936814, -9.776465, -2.755043, 0.647481},
    1.746336,
    4,
  },
  {
    {-3.922988, -4.468828, -0.168182, -1.794118},
    {6.823555, 7.772975, 0.292532, 3.120647},
    -0.574919,
    4,
  },
  {
    {-1.734066, 6.860335, -0.563636, 8.546962},
    {1.116888, -4.418646, 0.363030, -5.504979},
    -1.552588,
    4,
  },
  {
    {-46.076923, -0.614804, -2.266968, 5.005301},
    {-4.873030, -0.065021, -0.239751, 0.529353},
    9.455498,
    4,
  },
  {
    {-1.536649, -0.621477, -5.276237, 3.357625},
    {0.180857, 0.073145, 0.620989, -0.395177},
    -8.496504,
    4,
  },
  {
    {-23.081482, 3.253968, 9.947214, 11.147368},
    {-0.175828, 0.024788, 0.075775, 0.084918},
    131.272720,
    4,
  },
  {
    {6.822188, -3.111111, 1.361446, 1.222222},
    {-10.115658, 4.613027, -2.018695, -1.812260},
    -0.674419,
    4,
  },
  {
    {-8.295597, -1.411083, -7.092982, -8.830508},
    {1.373341, 0.233606, 1.174247, 1.461896},
    -6.040450,
    4,
  },
  {
    {2.900901, -7.182741, 6.293437, -10.607903},
    {0.268365, -0.664483, 0.582212, -0.981348},
    10.809524,
    4,
  },
  {
    {4.494062, 8.500000, -22.701923, 1.505313},
    {-1.156449, -2.187289, 5.841844, -0.387359},
    -3.886089,
    4,
  },
};

int main()
{
  unsigned int ind;
  unsigned int jnd;

  for (ind = 0; ind < sizeof(tests) / sizeof(struct divsc_test); ++ind) {
    switch (tests[ind].sz) {
      case 4:
        vec_divsc4f(tests[ind].va, tests[ind].sc);
        break;
      case 3:
        vec_divsc3f(tests[ind].va, tests[ind].sc);
        break;
      case 2:
        vec_divsc2f(tests[ind].va, tests[ind].sc);
        break;
      default:
        printf("error: ended up in default switch statement\n");
        return 2;
    }
    for (jnd = 0; jnd < tests[ind].sz; ++jnd) {
      if (!approx_equalf(tests[ind].vr[jnd],
                         tests[ind].va[jnd], APPROX_MAX_ERROR * 10)) {
        printf("fail: [%u] vr[%u] %f != va[%u] %f\n",
                ind, jnd, tests[ind].vr[jnd], jnd, tests[ind].va[jnd]);
        return 1;
      }
      printf("[%u] vr[%u] %f ~ va[%u] %f\n",
              ind, jnd, tests[ind].vr[jnd], jnd, tests[ind].va[jnd]);
    }
    printf("--\n");
  }

  return 0;
} 
