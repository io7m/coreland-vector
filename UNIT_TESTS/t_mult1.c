#include <stdio.h>
#include <math.h>
#include "../vector.h"
#include "t_util.h"

struct mult_test {
  float va[4];
  float vb[4];
  float vr[4];
  unsigned int sz;
  char align[12];
};

struct mult_test tests[] = {
  /* tools/mult_gen.c */
  {
    {0.000000, 0.000000, 0.000000, 0.000000},
    {0.000000, 0.000000, 0.000000, 0.000000},
    {0.000000, 0.000000, 0.000000, 0.000000},
    4,
  },
  {
    {-3.345133, 0.309562, 0.000000, 0.000000},
    {-15.473283, 11.209220, 0.000000, 0.000000},
    {51.760186, 3.469953, 0.000000, 0.000000},
    2,
  },
  {
    {-0.434560, -5.773016, 0.000000, 0.000000},
    {-5.261153, 5.190871, 0.000000, 0.000000},
    {2.286288, -29.966983, 0.000000, 0.000000},
    2,
  },
  {
    {6.095506, 1.492997, 0.000000, 0.000000},
    {-29.500000, -12.352185, 0.000000, 0.000000},
    {-179.817419, -18.441778, 0.000000, 0.000000},
    2,
  },
  {
    {-0.790909, 2.488426, 0.000000, 0.000000},
    {-0.728618, -0.674556, 0.000000, 0.000000},
    {0.576271, -1.678583, 0.000000, 0.000000},
    2,
  },
  {
    {-14.123077, -5.707129, 0.000000, 0.000000},
    {7.138958, 11.501279, 0.000000, 0.000000},
    {-100.824056, -65.639282, 0.000000, 0.000000},
    2,
  },
  {
    {-1.751295, 50.200001, 0.000000, 0.000000},
    {353.357147, -15.601010, 0.000000, 0.000000},
    {-618.832721, -783.170730, 0.000000, 0.000000},
    2,
  },
  {
    {-5.286274, -3.983784, 0.000000, 0.000000},
    {4.204380, 6.409857, 0.000000, 0.000000},
    {-22.225504, -25.535485, 0.000000, 0.000000},
    2,
  },
  {
    {-0.380682, 1.922902, 0.000000, 0.000000},
    {-6.875751, -8.142450, 0.000000, 0.000000},
    {2.617474, -15.657138, 0.000000, 0.000000},
    2,
  },
  {
    {46.083332, 7.586694, 0.000000, 0.000000},
    {-205.250000, -3.028061, 0.000000, 0.000000},
    {-9458.603906, -22.972973, 0.000000, 0.000000},
    2,
  },
  {
    {19.260275, 354.214294, 4.628247, 0.000000},
    {5.848883, -2.067227, -16.455446, 0.000000},
    {112.651097, -732.241313, -76.159866, 0.000000},
    3,
  },
  {
    {-5.172603, -4.723849, -12.674033, 0.000000},
    {-4.053712, 946.000000, -3.509684, 0.000000},
    {20.968243, -4468.761435, 44.481853, 0.000000},
    3,
  },
  {
    {8.200000, -18.577587, -2.337748, 0.000000},
    {10.289184, -1.764208, -1.110465, 0.000000},
    {84.371304, 32.774727, 2.595988, 0.000000},
    3,
  },
  {
    {2.290323, 5.436264, 5.417939, 0.000000},
    {-0.269231, -11.456310, -20.266666, 0.000000},
    {-0.616625, -62.279522, -109.803556, 0.000000},
    3,
  },
  {
    {1.331269, -2.036810, 2.428571, 0.000000},
    {-4.685544, 11.241546, -4.760120, 0.000000},
    {-6.237721, -22.896892, -11.560291, 0.000000},
    3,
  },
  {
    {7.718750, -9.071428, -20.614754, 0.000000},
    {-6.033426, -5.194357, -3.558770, 0.000000},
    {-46.570509, 47.120241, 73.363176, 0.000000},
    3,
  },
  {
    {-0.307398, 3.511706, 2.789116, 0.000000},
    {52.320000, 2.882129, -12.530769, 0.000000},
    {-16.083061, 10.121189, -34.949765, 0.000000},
    3,
  },
  {
    {-5.293103, 0.058978, 3.443322, 0.000000},
    {126.919998, 13.794286, -3.153302, 0.000000},
    {-671.800651, 0.813556, -10.857835, 0.000000},
    3,
  },
  {
    {-1.229008, -13.688272, 11.270769, 0.000000},
    {187.750000, 1.736677, -0.942783, 0.000000},
    {-230.746177, -23.772109, -10.625887, 0.000000},
    3,
  },
  {
    {30.939131, -4.367568, -4.478571, 0.000000},
    {-4.442841, -13.046070, 2.874824, 0.000000},
    {-137.457640, 56.979592, -12.875106, 0.000000},
    3,
  },
  {
    {-27.545454, -38.201550, -0.301866, -0.496552},
    {-3.400229, 9.033241, 4.142032, 2.826149},
    {93.660864, -345.083814, -1.250339, -1.403329},
    4,
  },
  {
    {-2.957611, 1.322667, -5.581897, 7.419069},
    {1.065546, 2.131098, 3.957480, 7.086176},
    {-3.151471, 2.818732, -22.090247, 52.572827},
    4,
  },
  {
    {3.664032, -3.874560, 6.476191, -4.513889},
    {-0.114053, -4.461078, -9.346591, -85.066666},
    {-0.417894, 17.284715, -60.530304, 383.981472},
    4,
  },
  {
    {-10.944700, 5.112051, -7.902439, 4.308540},
    {23.707317, 11.974555, -0.333333, -0.589245},
    {-259.469482, 61.214530, 2.634146, -2.538785},
    4,
  },
  {
    {-0.158416, 0.411978, -4.663147, -7.693452},
    {-1.705234, 4.918089, -94.666664, 8.969136},
    {0.270136, 2.026145, 441.444568, -69.003622},
    4,
  },
  {
    {9.586735, -19.231638, 6.639423, -9.398524},
    {1.018824, 2.489177, -2.859031, 5.421052},
    {9.767191, -47.870960, -18.982314, -50.949893},
    4,
  },
  {
    {-0.662632, -17.422535, -3.738095, 4.350291},
    {-16.285715, 0.497182, 11.981072, 37.160713},
    {10.791442, -8.662162, -44.786390, 161.659908},
    4,
  },
  {
    {3.865691, -7.508946, 0.224234, 3.861563},
    {-6.926422, -6.060241, -25.598902, -4.265750},
    {-26.775409, 45.506023, -5.740144, -16.472466},
    4,
  },
  {
    {15.856140, -3.204030, -1462.000000, 1.205882},
    {-0.682143, 12.936651, 404.100006, -2.983607},
    {-10.816153, -41.449422, -590794.208923, -3.597878},
    4,
  },
  {
    {1.295385, -6.990683, 440.181824, 6.009390},
    {1.286805, 7.142424, 84.109093, 1.964567},
    {1.666907, -49.930423, 37023.293822, 11.805849},
    4,
  },
};

int main()
{
  float tmp[4] = {0, 0, 0, 0};
  unsigned int ind;
  unsigned int jnd;

  for (ind = 0; ind < sizeof(tests) / sizeof(struct mult_test); ++ind) {
    switch (tests[ind].sz) {
      case 4:
        vec_mult4fx(tests[ind].va, tests[ind].vb, tmp);
        break;
      case 3:
        vec_mult3fx(tests[ind].va, tests[ind].vb, tmp);
        break;
      case 2:
        vec_mult2fx(tests[ind].va, tests[ind].vb, tmp);
        break;
      default:
        printf("error: ended up in default switch statement\n");
        return 2;
    }
    for (jnd = 0; jnd < tests[ind].sz; ++jnd) {
      if (!approx_equalf(tests[ind].vr[jnd], tmp[jnd], APPROX_MAX_ERROR)) {
        printf("fail: [%u] vr[%u] %f != tmp[%u] %f\n",
                ind, jnd, tests[ind].vr[jnd], jnd, tmp[jnd]);
        return 1;
      }
      printf("[%u] vr[%u] %f ~ tmp[%u] %f\n",
              ind, jnd, tests[ind].vr[jnd], jnd, tmp[jnd]);
    }
    printf("--\n");
  }

  return 0;
} 
