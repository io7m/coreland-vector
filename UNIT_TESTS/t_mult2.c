#include <stdio.h>
#include <math.h>
#include "../vector.h"
#include "t_util.h"

struct mult_test {
  float va[4];
  float vb[4];
  float vr[4];
  unsigned int sz;
};

struct mult_test tests[] = {
  /* tools/mult_gen.c */
  {
    {0.000000, 0.000000, 0.000000, 0.000000},
    {0.000000, 0.000000, 0.000000, 0.000000},
    {0.000000, 0.000000, 0.000000, 0.000000},
    4,
  },
  {
    {1.950530, 2.199148, 0.000000, 0.000000},
    {7.556338, -8.433921, 0.000000, 0.000000},
    {14.738864, -18.547440, 0.000000, 0.000000},
    2,
  },
  {
    {-0.681319, 24.875000, 0.000000, 0.000000},
    {-14.551601, 5.774674, 0.000000, 0.000000},
    {9.914278, 143.645014, 0.000000, 0.000000},
    2,
  },
  {
    {-2.464899, -4.510961, 0.000000, 0.000000},
    {-0.576190, 12.118705, 0.000000, 0.000000},
    {1.420251, -54.667005, 0.000000, 0.000000},
    2,
  },
  {
    {-0.606452, 2.595477, 0.000000, 0.000000},
    {-2.602195, 48.505619, 0.000000, 0.000000},
    {1.578105, 125.895235, 0.000000, 0.000000},
    2,
  },
  {
    {4.852761, 5.168565, 0.000000, 0.000000},
    {0.958282, -2.784664, 0.000000, 0.000000},
    {4.650314, -14.392716, 0.000000, 0.000000},
    2,
  },
  {
    {1.899846, 8.201406, 0.000000, 0.000000},
    {6.617647, 0.834990, 0.000000, 0.000000},
    {12.572510, 6.848092, 0.000000, 0.000000},
    2,
  },
  {
    {-10.708029, -2.736573, 0.000000, 0.000000},
    {-3.789298, 8.521187, 0.000000, 0.000000},
    {40.575908, -23.318850, 0.000000, 0.000000},
    2,
  },
  {
    {-3.037906, 0.290598, 0.000000, 0.000000},
    {-32.421051, -1.301127, 0.000000, 0.000000},
    {98.492111, -0.378105, 0.000000, 0.000000},
    2,
  },
  {
    {5.153929, 4.706602, 0.000000, 0.000000},
    {-1.677287, 0.842857, 0.000000, 0.000000},
    {-8.644616, 3.966993, 0.000000, 0.000000},
    2,
  },
  {
    {-6.505882, -8.738806, -12.143979, 0.000000},
    {7.134490, -0.267983, 2.616519, 0.000000},
    {-46.416152, 2.341852, -31.774955, 0.000000},
    3,
  },
  {
    {7.786942, -8.130137, -4.798267, 0.000000},
    {-2.745223, 8.630873, -8.918410, 0.000000},
    {-21.376891, -70.170182, 42.792917, 0.000000},
    3,
  },
  {
    {6.855513, -3.395604, -4.368328, 0.000000},
    {-9.447598, 54.642857, 2.387941, 0.000000},
    {-64.768135, -185.545523, -10.431308, 0.000000},
    3,
  },
  {
    {13.807511, -14.612583, 17.024271, 0.000000},
    {-3.744775, -3.333795, -0.265823, 0.000000},
    {-51.706017, 48.715358, -4.525439, 0.000000},
    3,
  },
  {
    {-24.405405, -1.789855, -67.435486, 0.000000},
    {-4.039720, 225.555557, -5.486486, 0.000000},
    {98.590993, -403.711770, 369.983878, 0.000000},
    3,
  },
  {
    {6.848355, -0.051170, -3.339956, 0.000000},
    {-6.465211, 4.068820, -7.691684, 0.000000},
    {-44.276062, -0.208200, 25.689884, 0.000000},
    3,
  },
  {
    {-0.859803, -40.759998, -14.145299, 0.000000},
    {-12.294118, -0.895490, -2.181223, 0.000000},
    {10.570518, 36.500154, 30.854047, 0.000000},
    3,
  },
  {
    {2.970495, 3.771717, 0.274914, 0.000000},
    {64.870964, -2.019480, -4.778146, 0.000000},
    {192.698889, -7.616909, -1.313580, 0.000000},
    3,
  },
  {
    {0.073171, -4.097068, 4.225243, 0.000000},
    {9.830397, 1.344262, -11.791444, 0.000000},
    {0.719297, -5.507534, -49.821711, 0.000000},
    3,
  },
  {
    {38.949581, -0.187692, -5.159631, 0.000000},
    {36.472870, 3.220963, 4.307210, 0.000000},
    {1420.603005, -0.604550, -22.223613, 0.000000},
    3,
  },
  {
    {21.668571, -12.783854, -24.415094, 2.914326},
    {-5.008872, -7.290909, 66.288460, -5.374644},
    {-108.535102, 93.205923, -1618.439001, -15.663464},
    4,
  },
  {
    {4.286852, 6.046413, 18.848740, -6.421875},
    {27.776470, 4.759346, -2.491704, -4.234375},
    {119.073627, 28.776974, -46.965489, 27.192627},
    4,
  },
  {
    {2.773543, -10.789634, -5.525773, -2.834437},
    {3.630952, 3.610104, -2.414676, 17.303030},
    {10.070601, -38.951696, 13.342950, -49.044351},
    4,
  },
  {
    {6.054469, -2.589905, 2.448980, 10.238806},
    {-3.840860, 5.170135, 1.216450, 20.087719},
    {-23.254369, -13.390159, 2.979062, 205.674253},
    4,
  },
  {
    {7.770115, 2.814679, -47.380951, -8.181519},
    {0.379265, -8.366822, 416.750000, -4.553776},
    {2.946933, -23.549918, -19746.011299, 37.256801},
    4,
  },
  {
    {-0.228972, -2.690661, -0.022272, 0.581232},
    {2.302500, -19.530304, 19.160427, 3.252427},
    {-0.527208, 52.549436, -0.426736, 1.890416},
    4,
  },
  {
    {-2.745491, 5.319767, 4.173684, 3.056196},
    {4.191710, 5.611520, 0.260163, -5.619266},
    {-11.508302, 29.851981, 1.085836, -17.173578},
    4,
  },
  {
    {-4.069189, -15.556098, -15.000000, -5.552402},
    {3.664122, 3.288270, -7.003390, -3.003348},
    {-14.910006, -51.152658, 105.050848, 16.675795},
    4,
  },
  {
    {-32.034481, -0.498956, -0.313669, -1.582503},
    {-3.393768, 8.820560, -11.933333, -16.563574},
    {108.717584, -4.401073, 3.743117, 26.211901},
    4,
  },
  {
    {19.094339, 0.975236, -3.258687, -5.883117},
    {-2.711934, 11.767568, 19.495495, 5.037677},
    {-51.782590, 11.476153, -63.529721, -29.637241},
    4,
  },
};

int main()
{
  unsigned int ind;
  unsigned int jnd;

  for (ind = 0; ind < sizeof(tests) / sizeof(struct mult_test); ++ind) {
    switch (tests[ind].sz) {
      case 4:
        vec_mult4f(tests[ind].va, tests[ind].vb);
        break;
      case 3:
        vec_mult3f(tests[ind].va, tests[ind].vb);
        break;
      case 2:
        vec_mult2f(tests[ind].va, tests[ind].vb);
        break;
      default:
        printf("error: ended up in default switch statement\n");
        return 2;
    }
    for (jnd = 0; jnd < tests[ind].sz; ++jnd) {
      if (!approx_equalf(tests[ind].vr[jnd],
                         tests[ind].va[jnd], APPROX_MAX_ERROR)) {
        printf("fail: [%u] vr[%u] %f != va[%u] %f\n",
                ind, jnd, tests[ind].vr[jnd], jnd, tests[ind].va[jnd]);
        return 1;
      }
      printf("[%u] vr[%u] %f ~ va[%u] %f\n",
              ind, jnd, tests[ind].vr[jnd], jnd, tests[ind].va[jnd]);
    }
    printf("--\n");
  }

  return 0;
} 
