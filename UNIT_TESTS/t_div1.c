#include <stdio.h>
#include <math.h>
#include "../vector.h"
#include "t_util.h"

struct div_test {
  float va[4];
  float vb[4];
  float vr[4];
  unsigned int sz;
  char align[12];
};

struct div_test tests[] = {
  /* tools/div_gen.c */
  {
    {1.000000, 1.000000, 1.000000, 1.000000},
    {1.000000, 1.000000, 1.000000, 1.000000},
    {1.000000, 1.000000, 1.000000, 1.000000},
    4,
  },
  {
    {-11.945946, 11.116010, 1.000000, 1.000000},
    {-2.658906, 8.421829, 1.000000, 1.000000},
    {4.492805, 1.319904, 1.000000, 1.000000},
    2,
  },
  {
    {-0.965969, 535.000000, 1.000000, 1.000000},
    {-17.221699, 52.690475, 1.000000, 1.000000},
    {0.056090, 10.153638, 1.000000, 1.000000},
    2,
  },
  {
    {10.147436, 9.875817, 1.000000, 1.000000},
    {-0.034483, 7.878130, 1.000000, 1.000000},
    {-294.275649, 1.253574, 1.000000, 1.000000},
    2,
  },
  {
    {-7.949429, -7.302783, 1.000000, 1.000000},
    {7.067278, 1.975610, 1.000000, 1.000000},
    {-1.124822, -3.696470, 1.000000, 1.000000},
    2,
  },
  {
    {-46.468750, 2.498534, 1.000000, 1.000000},
    {7.912088, -5.355102, 1.000000, 1.000000},
    {-5.873134, -0.466571, 1.000000, 1.000000},
    2,
  },
  {
    {-5.385735, 5.311602, 1.000000, 1.000000},
    {-6.481046, -15.447059, 1.000000, 1.000000},
    {0.830998, -0.343858, 1.000000, 1.000000},
    2,
  },
  {
    {-3.103634, -38.231884, 1.000000, 1.000000},
    {2.558537, 33.616665, 1.000000, 1.000000},
    {-1.213050, -1.137290, 1.000000, 1.000000},
    2,
  },
  {
    {8.437628, 5.016541, 1.000000, 1.000000},
    {5.262195, -38.485149, 1.000000, 1.000000},
    {1.603443, -0.130350, 1.000000, 1.000000},
    2,
  },
  {
    {16.814978, -0.310424, 1.000000, 1.000000},
    {-3.111783, 2.797546, 1.000000, 1.000000},
    {-5.403648, -0.110963, 1.000000, 1.000000},
    2,
  },
  {
    {106.620689, 18.175299, -19.101562, 1.000000},
    {-4.941300, 2.848572, 10.949368, 1.000000},
    {-21.577458, 6.380496, -1.744536, 1.000000},
    3,
  },
  {
    {-7.381356, -2.542056, -83.877190, 1.000000},
    {-5.176966, 2.165796, -2.219922, 1.000000},
    {1.425807, -1.173728, 37.783840, 1.000000},
    3,
  },
  {
    {47.729729, -4.872491, 13.025236, 1.000000},
    {-7.490842, -1.365735, 1.786408, 1.000000},
    {-6.371744, 3.567669, 7.291301, 1.000000},
    3,
  },
  {
    {4.652677, 11.267693, 5.073585, 1.000000},
    {-15.176030, 3.440000, -3.178879, 1.000000},
    {-0.306581, 3.275492, -1.596029, 1.000000},
    3,
  },
  {
    {-7.206897, 3.687032, 21.710526, 1.000000},
    {2.538043, -6.403462, 8.660044, 1.000000},
    {-2.839548, -0.575787, 2.506976, 1.000000},
    3,
  },
  {
    {-4.996572, 6.156992, 2.361678, 1.000000},
    {3.578947, 7.433190, -3.259012, 1.000000},
    {-1.396101, 0.828311, -0.724661, 1.000000},
    3,
  },
  {
    {4.995978, -1.141827, 8.021739, 1.000000},
    {5.117066, -7.673203, -16.170649, 1.000000},
    {0.976336, 0.148807, -0.496068, 1.000000},
    3,
  },
  {
    {-0.931994, -15.787234, -3.211950, 1.000000},
    {-1.149068, -3.729730, -0.433985, 1.000000},
    {0.811087, 4.232809, 7.401057, 1.000000},
    3,
  },
  {
    {4.012225, 0.535519, 3.598050, 1.000000},
    {10.538116, 9.513514, 3.808558, 1.000000},
    {0.380735, 0.056290, 0.944727, 1.000000},
    3,
  },
  {
    {-0.475177, 7.517188, -5.848214, 1.000000},
    {6.382239, -2.566304, 4.138462, 1.000000},
    {-0.074453, -2.929188, -1.413137, 1.000000},
    3,
  },
  {
    {4.790650, 1.215029, -5.373178, 3.881670},
    {9.540772, -5.720046, 1.431293, 2.056452},
    {0.502124, -0.212416, -3.754074, 1.887557},
    4,
  },
  {
    {-4.029985, -17.759542, 0.872549, 6.913793},
    {1.815514, -4.003817, 3.821033, 28.600000},
    {-2.219749, 4.435653, 0.228354, 0.241741},
    4,
  },
  {
    {-13.572756, -5.545727, -2.415289, 2.713889},
    {19.012346, 4.092174, -4.187582, -4.772727},
    {-0.713892, -1.355203, 0.576774, -0.568624},
    4,
  },
  {
    {-0.316199, -13.041667, 4.410229, -349.428558},
    {-3.024390, -21.044025, 4.747586, -4.084356},
    {0.104550, 0.619733, 0.928941, 85.552918},
    4,
  },
  {
    {-1.748619, 8.155039, 12.976471, 4.018657},
    {-5.489083, -10.345212, -22.139786, -3.137405},
    {0.318563, -0.788291, -0.586115, -1.280886},
    4,
  },
  {
    {-3.762376, -3.107833, -13.774285, 3.676056},
    {-3.578341, -30.673267, -5.224138, -24.245283},
    {1.051430, 0.101321, 2.636662, -0.151619},
    4,
  },
  {
    {-7.737931, -0.117722, -2.000000, 0.796167},
    {0.379913, -3.184906, 15.394872, 1.648496},
    {-20.367658, 0.036962, -0.129913, 0.482966},
    4,
  },
  {
    {-2.510448, -6.855519, -3.389610, -2.910198},
    {12.361111, 4.372657, -1.541728, -254.000000},
    {-0.203092, -1.567815, 2.198579, 0.011457},
    4,
  },
  {
    {-4.878285, 9.210526, 5.938380, -5.032967},
    {-6.690938, -21.359550, -24.290001, 2.296496},
    {0.729088, -0.431213, -0.244478, -2.191585},
    4,
  },
  {
    {7.560794, -16.288136, -9.364706, 16.504587},
    {4.689615, -7.462908, -6.264968, 0.349810},
    {1.612242, 2.182545, 1.494773, 47.181592},
    4,
  },
};

int main()
{
  float tmp[4] = {0, 0, 0, 0};
  unsigned int ind;
  unsigned int jnd;

  for (ind = 0; ind < sizeof(tests) / sizeof(struct div_test); ++ind) {
    switch (tests[ind].sz) {
      case 4:
        vec_div4fx(tests[ind].va, tests[ind].vb, tmp);
        break;
      case 3:
        vec_div3fx(tests[ind].va, tests[ind].vb, tmp);
        break;
      case 2:
        vec_div2fx(tests[ind].va, tests[ind].vb, tmp);
        break;
      default:
        printf("error: ended up in default switch statement\n");
        return 2;
    }
    for (jnd = 0; jnd < tests[ind].sz; ++jnd) {
      if (!approx_equalf(tests[ind].vr[jnd], tmp[jnd], APPROX_MAX_ERROR)) {
        printf("fail: [%u] vr[%u] %f != tmp[%u] %f\n",
                ind, jnd, tests[ind].vr[jnd], jnd, tmp[jnd]);
        return 1;
      }
      printf("[%u] vr[%u] %f ~ tmp[%u] %f\n",
              ind, jnd, tests[ind].vr[jnd], jnd, tmp[jnd]);
    }
    printf("--\n");
  }

  return 0;
} 
